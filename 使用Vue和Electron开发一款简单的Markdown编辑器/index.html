<!DOCTYPE html>
<html 
	lang="zh_CN">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		
<link rel="stylesheet" href="/blog/css/layout.css">

		
		<title> 使用Vue和Electron开发一款简单的Markdown编辑器 -  德布罗煜</title>
		<!-- <link rel="stylesheet" href="https://unpkg.com/mdui@1.0.2/dist/css/mdui.min.css" /> -->
		<!-- <script src="https://unpkg.com/mdui@1.0.2/dist/js/mdui.min.js"></script> -->
		
<link rel="stylesheet" href="/blog/lib/mdui/mdui.min.css">

		
<script src="/blog/lib/mdui/mdui.min.js"></script>

		<!-- lazyload -->
		
<script src="/blog/lib/lazysizes.js"></script>

		<!-- smooth-scrolling -->
		
<script src="/blog/lib/smooth-scrolling.js"></script>

		<!-- highlight -->
		
<link rel="stylesheet" href="/blog/lib/highlight/atom-one-dark.min.css">

		
<script src="/blog/lib/highlight/highlight.min.js"></script>

		<!-- 预置 kiraicon -->
		
<link rel="stylesheet" href="/blog/lib/iconfont/iconfont.css">

		
		<link
			rel="shortcut icon"
			href="https://kira.host/assets/Pictures/Others/116359b4ccf19917.jpg"
			type="image/png"
		/>
		
<link rel="stylesheet" href="/blog/deps/css/APlayer.min.css">

		
		
<script src="/blog/deps/js/APlayer.min.js"></script>
<script src="/blog/deps/js/Meting.min.js"></script>

	<meta name="generator" content="Hexo 7.3.0"></head>

	<body>
		<div
			class="kira-background"
			style="background-image: url('https://kira.host/assets/Pictures/Others/-f0d5cc34c6e5aa7_compressed.jpg')"
		></div>
		<div class="kira-header">
    <a
        class="kira-drawer-button mdui-ripple"
        title="导航栏"
        onclick="document.querySelector('.kira-sidebar-modal').classList.add('show');document.querySelector('.kira-sidebar#sidebar').classList.add('show');"
    >
        <i class="kirafont icon-menu"></i>
    </a>
    <a href="/blog/" title="德布罗煜">
        <img
			src="https://kira.host/assets/Pictures/Others/20220922230447.jpg"
			alt="德布罗煜"
		/>
    </a>
</div>
		<div class="kira-body">
			<div class="kira-sidebar" id="sidebar">
	<div class="kira-avatar mdui-ripple">
		<a href="https://kira.host/assets/Pictures/Others/20220922230447.jpg" title="德布罗煜">
			<img
				src="https://kira.host/assets/Pictures/Others/20220922230447.jpg"
				alt="德布罗煜"
			/>
		</a>
	</div>
	<div class="kira-count">
		<div><span>文章</span>30</div>
		<div><span>标签</span>14</div>
		<div><span>分类</span>3</div>
	</div>
	<div class="kira-list">
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/blog/"
			title="回到首页"
		>
			<i
				class="kirafont
					
						icon-home
					"
			></i>
			<div class="kira-list-item-content">
				回到首页
			</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/blog/archive.html"
			title="文章归档"
		>
			<i
				class="kirafont
					
						icon-container
					"
			></i>
			<div class="kira-list-item-content">
				文章归档
			</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/blog/about.html"
			title="关于本人"
		>
			<i
				class="kirafont
					
						icon-user
					"
			></i>
			<div class="kira-list-item-content">
				关于本人
			</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/blog/friends.html"
			title="我的朋友"
		>
			<i
				class="kirafont
					
						icon-team
					"
			></i>
			<div class="kira-list-item-content">
				我的朋友
			</div>
		</a>
		
	</div>
	<aside id="kira-sidebar">
		
			<div class="kira-widget-wrap">
	<div class="kira-widget kira-social">
		
			<a
				class="mdui-ripple"
				href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=1056317718&website=www.oicqzone.com"
				target="_blank"
				mdui-tooltip="{content: 'QQ'}"
				style="color: rgb(49, 174, 255); background-color: rgba(49, 174, 255, .1);"
			>
				<i
					class="kirafont
					
						icon-QQ
					"
				></i>
			</a>
		
			<a
				class="mdui-ripple"
				href="https://space.bilibili.com/27905679"
				target="_blank"
				mdui-tooltip="{content: '哔哩哔哩'}"
				style="color: rgb(231, 106, 141); background-color: rgba(231, 106, 141, .15);"
			>
				<i
					class="kirafont
					
						icon-bilibili
					"
				></i>
			</a>
		
			<a
				class="mdui-ripple"
				href="https://github.com/ch1ny/"
				target="_blank"
				mdui-tooltip="{content: 'GitHub'}"
				style="color: rgb(25, 23, 23); background-color: rgba(25, 23, 23, .15);"
			>
				<i
					class="kirafont
					
						icon-github
					"
				></i>
			</a>
		
			<a
				class="mdui-ripple"
				href="https://gitee.com/ch1ny"
				target="_blank"
				mdui-tooltip="{content: 'Gitee'}"
				style="color: rgb(165, 15, 15); background-color: rgba(165, 15, 15, .15);"
			>
				<i
					class="kirafont
					
						icon-gitee
					"
				></i>
			</a>
		
	</div>
</div>

		
			
  <div class="kira-widget-wrap">
    <h3 class="kira-widget-title">分类</h3>
    <div class="kira-widget">
      <ul class="category-list">
        
        

        
          <li class="category-list-item">
            <a class="category-list-link" href="/blog/categories/Revue/">
              Revue
            </a>
            <span class="category-list-count">5</span>
          </li>
        
          <li class="category-list-item">
            <a class="category-list-link" href="/blog/categories/编程/">
              编程
            </a>
            <span class="category-list-count">23</span>
          </li>
        
          <li class="category-list-item">
            <a class="category-list-link" href="/blog/categories/面经/">
              面经
            </a>
            <span class="category-list-count">2</span>
          </li>
        
      </ul>
    </div>
  </div>

		
			
	<div class="kira-widget-wrap">
		<div id="randomtagcloud" class="kira-widget tagcloud kira-rainbow">
			<a href="/blog/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/blog/tags/Node-js/" style="font-size: 16px;">Node.js</a> <a href="/blog/tags/React/" style="font-size: 18px;">React</a> <a href="/blog/tags/Revue/" style="font-size: 18px;">Revue</a> <a href="/blog/tags/Rust/" style="font-size: 14px;">Rust</a> <a href="/blog/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/blog/tags/Unity3D/" style="font-size: 10px;">Unity3D</a> <a href="/blog/tags/VSCODE/" style="font-size: 12px;">VSCODE</a> <a href="/blog/tags/Vue/" style="font-size: 10px;">Vue</a> <a href="/blog/tags/electron/" style="font-size: 10px;">electron</a> <a href="/blog/tags/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8/" style="font-size: 10px;">字节跳动</a> <a href="/blog/tags/%E8%9A%82%E8%9A%81/" style="font-size: 10px;">蚂蚁</a> <a href="/blog/tags/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4/" style="font-size: 10px;">阿里巴巴</a> <a href="/blog/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 12px;">面试</a>
		</div>
		
	</div>


		
	</aside>
	<div class="kira-copyright">
		&copy; 2024
		<a href="/blog/">德布罗煜</a>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> &
		<a href="https://github.com/ch1ny/kira-hexo/" target="_blank">Kira-Hexo</a>
		<br />
		
			<a
				href="https://beian.miit.gov.cn/"
				target="_blank"
			>
				赣ICP备2021007955号-3
			</a>
		
		<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></div><div><span id="busuanzi_container_site_uv">共接待访客<span id="busuanzi_value_site_uv"></span>位</span></div>
	</div>
</div>
<div
	class="kira-sidebar-modal"
	id="sidebar-modal"
	onclick="(function(self) {
		self.classList.remove('show');
		document.querySelector('.kira-sidebar.show#sidebar').classList.remove('show');
	})(this)"
></div>
			<div class="kira-content">
				<div id="kira-top-header"></div>
				<div class="kira-main-content">
					
<link rel="stylesheet" href="/blog/css/kira-image.css">


<script src="/blog/js/kira-image.js"></script>

<div class="kira-image">
    <div class="kira-image-modal">
        <div class="kira-image-header">
            <div class="kira-image-counter"></div>
            <div class="kira-image-title"></div>
            <div class="kira-image-operation">
                <div class="kira-image-operation-button" id="kira-image-operation-button-zoom">
                    <i class="kirafont icon-zoom-in"></i>
                </div>
                <div class="kira-image-operation-button" id="kira-image-operation-button-close">
                    <i class="kirafont icon-close"></i>
                </div>
            </div>
        </div>
        <div class="kira-image-container">
            <div class="kira-image-prev-button-panel">
                <div class="kira-image-exchange-button">
                    <i class="kirafont icon-left"></i>
                </div>
            </div>
            <div class="kira-image-list">
                <div class="kira-image-prev">
                    <img />
                </div>
                <div class="kira-image-now">
                    <img />
                </div>
                <div class="kira-image-next">
                    <img />
                </div>
            </div>
            <div class="kira-image-next-button-panel">
                <div class="kira-image-exchange-button">
                    <i class="kirafont icon-right"></i>
                </div>
            </div>
        </div>
    </div>
</div>

	
<link rel="stylesheet" href="/blog/css/kira-code-copy.css">

	
<script src="/blog/js/kira-code-copy.js"></script>


<div class="kira-post">
	<article>
		
		<div
			class="kira-post-cover"
			style="padding-bottom: '56.25%'"
		>
			<img
				data-src="https://kira.host/assets/Pictures/Others/-f0d5cc34c6e5aa7_compressed.jpg"
				data-sizes="auto"
				alt="使用Vue和Electron开发一款简单的Markdown编辑器"
				class="lazyload kira-post-cover-image disabled-kira-image"
			/>
			<h1>使用Vue和Electron开发一款简单的Markdown编辑器</h1>
		</div>
		
		<div class="kira-post-meta kira-rainbow" style="margin:10px 0!important;">
			<a><i class="kirafont icon-calendar-fill"></i>2021年12月16日</a>
			<a><i class="kirafont icon-edit-fill"></i>6k 字</a>
			<a><i class="kirafont icon-time-circle-fill"></i>大概 28 分钟</a>
		</div>
		<html><head></head><body><blockquote>
<p>本文并不涉及自己设计一套 Markdown 渲染组件的部分，Markdown 渲染组件可通过 <strong>marked</strong> 和 <strong>highlight.js</strong> 自行实现。但本文重点在于如何使用 Electron 和 Vue 打造一款桌面应用，因此 Markdown 渲染组件便不再重复造轮子，而是直接采用了 <strong>mavon-editor</strong>。<br><strong>因此，如果是想要学习如何自己写一个 Markdown 文本渲染组件的读者不必在本文浪费过多时间。</strong></p>
</blockquote>
<span id="more"></span>

<!-- toc -->

<ul>
<li><a href="#electron">Electron</a><ul>
<li><a href="#%E7%AE%80%E4%BB%8B">简介</a></li>
<li><a href="#%E5%AE%89%E8%A3%85">安装</a></li>
</ul>
</li>
<li><a href="#%E5%88%9B%E5%BB%BA-vueelectron-%E9%A1%B9%E7%9B%AE">创建 Vue/Electron 项目</a></li>
<li><a href="#backgroundjs">background.js</a></li>
<li><a href="#%E6%97%A0%E7%AA%97%E5%8F%A3%E5%BA%94%E7%94%A8">无窗口应用</a><ul>
<li><a href="#contextisolation">contextIsolation</a></li>
<li><a href="#ipcrenderer-%E9%80%9A%E4%BF%A1">ipcRenderer 通信</a></li>
</ul>
</li>
<li><a href="#%E5%BC%95%E5%85%A5-mavon-editor">引入 Mavon-editor</a></li>
<li><a href="#electron-%E6%93%8D%E4%BD%9C%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6">electron 操作本地文件</a><ul>
<li><a href="#%E6%89%93%E5%BC%80-markdown-%E6%96%87%E4%BB%B6">打开 markdown 文件</a></li>
<li><a href="#%E5%8F%A6%E5%AD%98%E4%B8%BA%E6%96%B0%E6%96%87%E4%BB%B6">另存为新文件</a></li>
<li><a href="#%E5%AF%BC%E5%87%BA%E4%B8%BA-html">导出为 HTML</a></li>
<li><a href="#%E7%BC%96%E8%BE%91%E6%97%B6%E4%BF%9D%E5%AD%98%E6%96%87%E4%BB%B6">编辑时保存文件</a></li>
<li><a href="#%E5%AF%BC%E5%85%A5%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87">导入本地图片</a></li>
</ul>
</li>
<li><a href="#%E7%BB%93%E5%B0%BE">结尾</a></li>
</ul>
<!-- tocstop -->

<h1><span id="electron">Electron</span></h1><h2><span id="%E7%AE%80%E4%BB%8B">简介</span></h2><p><strong>Electron</strong> 是一款利用 JavaScript、HTML 和 CSS 开发跨平台桌面应用的开源框架。它内置了<strong>Chromium</strong> 内核和 <strong>Node</strong>，使得我们写的单页应用程序能够运行在桌面端的类浏览器平台中。因此，我们可以通过书写 Web 代码来实现桌面应用的 GUI 布局，也可以通过 JavaScript 调用 Node.js 提供的丰富的原生 API。<br>目前已经有非常多的应用使用 Electron 进行开发，其中最出名的莫过于几乎每个前端程序员都必定接触过的 <strong>Visual Studio Code</strong>。</p>
<h2><span id="%E5%AE%89%E8%A3%85">安装</span></h2><p>刚才我们也提到了，Electron 是基于 Node.js 运行的，首先你需要先在你的 PC 上安装好 Node。<br>在安装好 Node.js 后，我们打开终端，在终端中输入：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install -g electron <span class="hljs-comment"># 全局安装 electron</span><br></code></pre></td></tr></tbody></table></figure>

<p>安装完毕后，查看 Electron 的版本号检查是否安装成功：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">electron -v<br>v16.0.4<br></code></pre></td></tr></tbody></table></figure>

<p>当然你也可以不进行全局安装，只针对某一项目进行安装。接下来，我就将讲解如何使用 Electron 开发一款简单的 基于 Vue 的 Markdown 编辑器。</p>
<h1><span id="%E5%88%9B%E5%BB%BA-vueelectron-%E9%A1%B9%E7%9B%AE">创建 Vue/Electron 项目</span></h1><blockquote>
<p>本文默认读者此时已具备 vue 基础，并且在开发环境中全局安装了 vue-cli 工具</p>
</blockquote>
<p>打开终端，输入创建 Vue 项目的指令：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">vue create typark <span class="hljs-comment"># 创建名为 Typark 的 Vue 项目</span><br><br><span class="hljs-built_in">cd</span> typark <span class="hljs-comment"># 进入 Typark 文件夹中</span><br></code></pre></td></tr></tbody></table></figure>

<p>进入 Typark 文件夹后，我们可以通过输入 <code>yarn serve</code> 来启动 Vue 项目，我们便能通过浏览器进行访问。但我们的目的是要得到一份能够独立运行于桌面端的应用，那么自然不能通过这种方式实现。因此，我们需要给这个项目添加上 Electron 依赖。我们打开终端，在终端中敲入命令：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vue add electron-builder<br></code></pre></td></tr></tbody></table></figure>

<p>在安装完毕后，我们可以在项目的 <code>package.json</code> 文件中看到安装的所有依赖了。并且在 <code>scripts</code> 字段下多出了几条启动项：</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json">scripts<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><br>    <span class="hljs-comment">// ... ,</span><br>    <span class="hljs-attr">"elect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"electron ."</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">"electron:build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-cli-service electron:build"</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">"electron:serve"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-cli-service electron:serve"</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">"postinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"electron-builder install-app-deps"</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">"postuninstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"electron-builder install-app-deps"</span><br><span class="hljs-punctuation">}</span><br></code></pre></td></tr></tbody></table></figure>

<p>package 的 <code>main</code> 字段也变成了 <code>background.js</code>。我们前往项目的 <code>src</code> 文件夹下，就能看见该文件，它将作为 Electron 应用的入口文件。<br>此时我们的依赖已经安装成功了，其中当我们在控制台中敲入 <code>yarn electron:serve</code> 时，就会使用 Electron 自动开启项目。<br><img data-fancybox="gallery" data-sizes="auto" data-src="https://img-blog.csdnimg.cn/c14c38ecaa704c81bf8a7997a21fa942.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5bCP5qCX5bi95LuK5aSp5ZCD5LuA5LmI,size_20,color_FFFFFF,t_70,g_se,x_16" alt="electron" class="lazyload"></p>
<p>致此，我们已经成功建立起了一个基于 vue 的 electron 项目，我们可以进入到下一阶段了。</p>
<blockquote>
<p>在启动项目时，很有可能会遇到这样的问题：控制台中一直在打印如下的字符串：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">Launching Electron...<br>Failed to fetch extension, trying 4 more <span class="hljs-built_in">times</span><br>Failed to fetch extension, trying 3 more <span class="hljs-built_in">times</span><br>Failed to fetch extension, trying 2 more <span class="hljs-built_in">times</span><br>Failed to fetch extension, trying 1 more <span class="hljs-built_in">times</span><br></code></pre></td></tr></tbody></table></figure>

<p>虽然就结果而言，项目终究还是成功启动了，但是每次这样启动都会花费很长的时间。<br>这是由于我们处于开发模式下，electron 在启动的时候会安装一遍 <code>Vue Devtools</code> ，而我们因为网络中一些不可明说的原因连接不上。不过这个工具并不是很重要，因此我这里给出一个解决方案：<br>进入 <code>background.js</code> 文件中，找到 <code>// Install Vue Devtools</code> 注释，将它下面的安装代码全部注释掉，就像这样：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span> (isDevelopment &amp;&amp; !process.<span class="hljs-property">env</span>.<span class="hljs-property">IS_TEST</span>) {<br>    <span class="hljs-comment">// Install Vue Devtools</span><br>    <span class="hljs-comment">// try {</span><br>    <span class="hljs-comment">//   await installExtension(VUEJS_DEVTOOLS)</span><br>    <span class="hljs-comment">// } catch (e) {</span><br>    <span class="hljs-comment">//   console.error('Vue Devtools failed to install:', e.toString())</span><br>    <span class="hljs-comment">// }</span><br>}<br></code></pre></td></tr></tbody></table></figure>

<p>这样一来，我们就可以跳过安装环节，快速启动应用了。</p>
</blockquote>
<h1><span id="backgroundjs">background.js</span></h1><p>位于 <strong>src</strong> 文件夹下的 <strong>background.js</strong> 是 electron 应用的入口文件，我们可以在这里书写一些 Node 代码来调控整个 electron 应用的窗口。<br>先让我们将注意力聚焦在其中的 <code>async function createWindow()</code> 上吧，在这个异步方法中，书写了 electron 创建一个窗口时所作的工作。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createWindow</span>(<span class="hljs-params"></span>) {<br>    <span class="hljs-comment">// Create the browser window.</span><br>    <span class="hljs-keyword">const</span> win = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BrowserWindow</span>({<br>        <span class="hljs-attr">width</span>: <span class="hljs-number">800</span>,<br>        <span class="hljs-attr">height</span>: <span class="hljs-number">600</span>,<br>        <span class="hljs-attr">webPreferences</span>: {<br>            <span class="hljs-comment">// Use pluginOptions.nodeIntegration, leave this alone</span><br>            <span class="hljs-comment">// See nklayman.github.io/vue-cli-plugin-electron-builder/guide/security.html#node-integration for more info</span><br>            <span class="hljs-attr">nodeIntegration</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">ELECTRON_NODE_INTEGRATION</span>,<br>            <span class="hljs-attr">contextIsolation</span>: !process.<span class="hljs-property">env</span>.<span class="hljs-property">ELECTRON_NODE_INTEGRATION</span>,<br>        },<br>    });<br><br>    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">WEBPACK_DEV_SERVER_URL</span>) {<br>        <span class="hljs-comment">// Load the url of the dev server if in development mode</span><br>        <span class="hljs-keyword">await</span> win.<span class="hljs-title function_">loadURL</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">WEBPACK_DEV_SERVER_URL</span>);<br>        <span class="hljs-keyword">if</span> (!process.<span class="hljs-property">env</span>.<span class="hljs-property">IS_TEST</span>) win.<span class="hljs-property">webContents</span>.<span class="hljs-title function_">openDevTools</span>();<br>    } <span class="hljs-keyword">else</span> {<br>        <span class="hljs-title function_">createProtocol</span>(<span class="hljs-string">'app'</span>);<br>        <span class="hljs-comment">// Load the index.html when not in development</span><br>        win.<span class="hljs-title function_">loadURL</span>(<span class="hljs-string">'app://./index.html'</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>首先通过 <code>new BrowserWindow</code> 实例化一个浏览器窗口类，在实例化时向窗口类中传递一个写有窗口参数的 json 对象。创建完毕后，判断当前是否处在开发模式下，并根据不同状态向 <code>BrowserWindow.loadURL</code> 中传入不同的 url ，让之前初始化的浏览器窗口加载不同的页面。<br>接下来，我们回到 <strong>background.js</strong> 的顶部，我们看到，除了在 <code>createWindow</code> 中使用过的 <code>BrowserWindow</code>，我们还从 <code>electron</code> 中引入了 <code>app</code> 模块，我们可以通过这个模块监听和控制整个 electron 应用。我们向下滑动代码，在 <code>createWindow</code> 方法下，有几个形如 <code>app.on('',()=&gt;{})</code> 的代码块。这里的 <code>app.on</code> 则是为 electron 应用注册事件监听。举个例子：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">on</span>(<span class="hljs-string">'window-all-closed'</span>, <span class="hljs-function">() =&gt;</span> {<br>    <span class="hljs-comment">// On macOS it is common for applications and their menu bar</span><br>    <span class="hljs-comment">// to stay active until the user quits explicitly with Cmd + Q</span><br>    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">platform</span> !== <span class="hljs-string">'darwin'</span>) {<br>        app.<span class="hljs-title function_">quit</span>();<br>    }<br>});<br></code></pre></td></tr></tbody></table></figure>

<p>这一段代码，是在监听 <code>window-all-closed</code> 这个事件，当应用的所有窗口都被关闭后，如果程序运行的平台不是在 MacOS 上，那么就调用 <code>app.quit()</code> 终止程序的运行。</p>
<blockquote>
<p>MacOS 中，即使关闭所有窗口，程序一般还是会继续运行，直到用户通过 Cmd + Q 的组合键明确终止应用运行</p>
</blockquote>
<p>一个基础的 background.js 就是这些内容，后续我还将在开发这款应用时继续介绍一些新的内容。</p>
<h1><span id="%E6%97%A0%E7%AA%97%E5%8F%A3%E5%BA%94%E7%94%A8">无窗口应用</span></h1><p>有没有觉得之前给大家展示的 electron 的截图中，这个窗口很弱？<br><img data-fancybox="gallery" data-sizes="auto" data-src="https://img-blog.csdnimg.cn/c7b37ec1cfb745d6af58a65ba65af523.png" alt="在这里插入图片描述" class="lazyload"><br>有没有觉得这种默认窗口很单调，完全没有新鲜感？想不想自己设计一个窗口来替代这个原本的窗口？如果你觉得是，那么好的，我将教会你如何使用 electron 打造一款 “无窗口应用” 。<br>让我们前往 <strong>background.js</strong> 中，来到之前我们讨论过的 <code>createWindow</code> 方法下。我们来手动为 BrowserWindow 添加一些配置，以使其达到消除边框的效果。我们给它添加一行代码 <code>frame: false</code> ，表示我们不想使用系统的默认窗口。添加完后，我们再次启动项目，就会发现原来的窗口边框已经消失不见了。<br><img data-fancybox="gallery" data-sizes="auto" data-src="https://img-blog.csdnimg.cn/e27c71d9923b4b078ff106352bd954ca.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5bCP5qCX5bi95LuK5aSp5ZCD5LuA5LmI,size_20,color_FFFFFF,t_70,g_se,x_16" alt="无边框窗口" class="lazyload"><br>接下来我们就可以自己设计一个独特的窗口和菜单栏了。<br>为了加快开发进度，我们不再重复造轮子，直接向项目中引入 <strong>ElementUI</strong>，引入方法可参见 <strong>ElementUI</strong> 的<a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/installation">官方文档-安装</a>。<br>我们先将 App.vue 中的内容清空，呈现一个空白页面。下面我们就可以开始书写我们的顶部边栏了。</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"head"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./assets/logo.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">" "</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"windowLogo"</span> /&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Typark<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"windowBtn"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"closeWindowBtn"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-close"</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"windowBtn"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"resizeBtn"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"maxSize?'el-icon-copy-document':'el-icon-full-screen'"</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"windowBtn"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"miniSizeBtn"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-minus"</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>: <span class="hljs-string">'App'</span>,</span><br><span class="language-javascript">        <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) {</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> {</span><br><span class="language-javascript">                <span class="hljs-attr">maxSize</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 当前窗口是否最大化</span></span><br><span class="language-javascript">            };</span><br><span class="language-javascript">        },</span><br><span class="language-javascript">    };</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">    * {</span><br><span class="language-css">        <span class="hljs-attribute">margin</span>: <span class="hljs-number">0%</span>;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-id">#app</span> {</span><br><span class="language-css">        <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;</span><br><span class="language-css">        <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;</span><br><span class="language-css">        <span class="hljs-attribute">overflow</span>: hidden;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-comment">/* 应用图标 */</span></span><br><span class="language-css">    <span class="hljs-selector-id">#windowLogo</span> {</span><br><span class="language-css">        <span class="hljs-attribute">width</span>: <span class="hljs-number">2.5em</span>;</span><br><span class="language-css">        <span class="hljs-attribute">height</span>: <span class="hljs-number">2.5em</span>;</span><br><span class="language-css">        <span class="hljs-attribute">vertical-align</span>: top; <span class="hljs-comment">/* 这里只要不是 baseline 就行，防止 img 与 span 垂直方向不在同一水平线上 */</span></span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-comment">/* 绘制一个好看一点的滚动条 */</span></span><br><span class="language-css">    ::-webkit-scrollbar {</span><br><span class="language-css">        <span class="hljs-attribute">width</span>: <span class="hljs-number">6px</span>;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    ::-webkit-scrollbar-thumb {</span><br><span class="language-css">        <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#a8a8a8</span>;</span><br><span class="language-css">        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">3px</span>;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-class">.head</span> {</span><br><span class="language-css">        <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;</span><br><span class="language-css">        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">height</span>: <span class="hljs-number">2.5em</span>;</span><br><span class="language-css">        <span class="hljs-attribute">line-height</span>: <span class="hljs-number">2.5em</span>;</span><br><span class="language-css">        <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">linear-gradient</span>(to right, <span class="hljs-number">#b9b9b9</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#ffffff</span> <span class="hljs-number">75%</span>); <span class="hljs-comment">/* 绘制渐变 */</span></span><br><span class="language-css">        <span class="hljs-attribute">position</span>: relative;</span><br><span class="language-css">        <span class="hljs-attribute">z-index</span>: <span class="hljs-number">9999</span>; <span class="hljs-comment">/* 防止其他 dom 元素覆盖在顶部边栏上方 */</span></span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-class">.windowBtn</span> {</span><br><span class="language-css">        <span class="hljs-attribute">float</span>: right;</span><br><span class="language-css">        <span class="hljs-attribute">height</span>: <span class="hljs-number">2.25em</span>;</span><br><span class="language-css">        <span class="hljs-attribute">width</span>: <span class="hljs-number">3em</span>;</span><br><span class="language-css">        <span class="hljs-attribute">line-height</span>: <span class="hljs-number">2.5em</span>;</span><br><span class="language-css">        <span class="hljs-attribute">border</span>: none;</span><br><span class="language-css">        <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span><br><span class="language-css">        <span class="hljs-attribute">outline</span>: none;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-class">.windowBtn</span><span class="hljs-selector-pseudo">:hover</span> {</span><br><span class="language-css">        <span class="hljs-attribute">cursor</span>: pointer;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-id">#miniSizeBtn</span><span class="hljs-selector-pseudo">:hover</span> {</span><br><span class="language-css">        <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e0e0e0</span>;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-id">#resizeBtn</span><span class="hljs-selector-pseudo">:hover</span> {</span><br><span class="language-css">        <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#00a2ff</span>;</span><br><span class="language-css">        <span class="hljs-attribute">color</span>: white;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-id">#closeWindowBtn</span><span class="hljs-selector-pseudo">:hover</span> {</span><br><span class="language-css">        <span class="hljs-attribute">background-color</span>: red;</span><br><span class="language-css">        <span class="hljs-attribute">color</span>: white;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://img-blog.csdnimg.cn/a2abaf13e9654c9d9642a9d75ea4e454.png" alt="在这里插入图片描述" class="lazyload"></p>
<p>这样一来我们就为我们的应用创建了一个顶部边栏。但是但是但是！我们现在惊讶地发现一件事情：我们没有办法拖动这个窗口，而且还会莫名其妙的选中顶部边栏的文字，甚至连 logo 的 img 都可以被拖拽！<br><img data-fancybox="gallery" data-sizes="auto" data-src="https://img-blog.csdnimg.cn/5a9988631b3440a29d0b54eaddea7252.png" alt="在这里插入图片描述" class="lazyload"><br>这么看起来，这似乎是个愚蠢到极致的顶部边栏，但其实我们只需要添加几行 css 代码，就可以完美解决上述问题：</p>
<ul>
<li><strong>顶部边栏的文字会被选中</strong>：为 <code>.head</code> 添加 <code>user-select: none</code></li>
<li><strong>窗口无法被拖动</strong>：为 <code>.head</code> 添加 <code>-webkit-app-region: drag</code> ，同时，为了防止用户通过右上角三个按钮也能拖拽窗口，我们还需要为 <code>.windowBtn</code> 添加 <code>-webkit-app-region: no-drag</code></li>
<li><strong>应用 logo 会被拖拽出来</strong>：为 <code>.head img</code> 添加 <code>-webkit-user-drag: none</code></li>
</ul>
<p>添加完上述 css 代码后，我们就将这个 “愚蠢的顶部边栏” 修改成了 “没那么愚蠢的顶部边栏”。<br>我们还要让这个顶部边栏负起它需要承担的责任：控制窗口的缩放和关闭。这里我们就需要引入一个新的 electron 模块了—— <strong>electron.ipcRenderer</strong>。</p>
<h2><span id="contextisolation">contextIsolation</span></h2><p>接下来，我们需要前往 <strong>background.js</strong> 中，继续为 BrowserWindow 添加新的属性。在 BrowserWindow 中，我们有这样一条字段：<code>webPreferences</code>。我们直接将其修改为下面的形式：</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">webPreferences<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><br>    webSecurity<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 禁用同源政策</span><br>    nodeIntegration<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 启用 Node 集成</span><br>    contextIsolation<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 禁用上下文隔离</span><br><span class="hljs-punctuation">}</span><br></code></pre></td></tr></tbody></table></figure>

<p><strong>contextIsolation</strong> 这个属性是为了确保我们的 <code>预加载脚本</code> 和 Electron 的内部逻辑在一个单独的上下文中运行到我们加载的网页，这样一来我们加载的网页页面就无法直接调用 Node 相关的 API。<br>我们将这条属性设置为 <code>false</code>，表示不需要进行上下文隔离，这样一来，我们就可以在 vue 页面中，调用 electron 模块了。</p>
<h2><span id="ipcrenderer-%E9%80%9A%E4%BF%A1">ipcRenderer 通信</span></h2><p>因为 electron 应用的窗口是由 <strong>background.js</strong> 控制的，我们要通过 vue 实现控制窗口必须要想办法与 <strong>background.js</strong> 进行通信，那么 <strong>electron.ipcRenderer</strong> 就成为了我们的首选。我们先为 <strong>background.js</strong> 书写几个接收器。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createWindow</span>(<span class="hljs-params"></span>) {<br>    <span class="hljs-comment">// Create the browser window.</span><br>    <span class="hljs-keyword">const</span> win = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BrowserWindow</span>({...});<br>    <span class="hljs-comment">//接收渲染进程的信息</span><br>    <span class="hljs-keyword">const</span> ipc = <span class="hljs-built_in">require</span>(<span class="hljs-string">'electron'</span>).<span class="hljs-property">ipcMain</span>;<br><br>    <span class="hljs-comment">// 接到 'min' 信息</span><br>    ipc.<span class="hljs-title function_">on</span>(<span class="hljs-string">'min'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {<br>        win.<span class="hljs-title function_">minimize</span>(); <span class="hljs-comment">// 窗口最小化</span><br>    });<br><br>    <span class="hljs-comment">// 接到 'max' 信息</span><br>    ipc.<span class="hljs-title function_">on</span>(<span class="hljs-string">'max'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {<br>        <span class="hljs-keyword">if</span> (win.<span class="hljs-title function_">isMaximized</span>()) { <span class="hljs-comment">// 判断窗口是否最大化</span><br>            win.<span class="hljs-title function_">unmaximize</span>(); <span class="hljs-comment">// 窗口取消最大化</span><br>        } <span class="hljs-keyword">else</span> {<br>            win.<span class="hljs-title function_">maximize</span>(); <span class="hljs-comment">// 窗口最大化</span><br>        }<br>    });<br>    ipc.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {<br>        win.<span class="hljs-title function_">destroy</span>(); <span class="hljs-comment">// 摧毁窗口</span><br>    })<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>接下来，我们给 vue 页面中的按钮添加几个方法：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"head"</span>&gt;</span><br>            /* ... */<br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"windowBtn"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"closeWindowBtn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"closeWindow"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-close"</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"windowBtn"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"resizeBtn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"resizeWindow"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"maxSize?'el-icon-copy-document':'el-icon-full-screen'"</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"windowBtn"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"miniSizeBtn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"minWindow"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-minus"</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> electron = <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">require</span>(<span class="hljs-string">'electron'</span>); <span class="hljs-comment">// 导入 electron</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {</span><br><span class="language-javascript">        <span class="hljs-comment">// ... ,</span></span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: {</span><br><span class="language-javascript">            <span class="hljs-title function_">closeWindow</span>(<span class="hljs-params"></span>) {</span><br><span class="language-javascript">                electron.<span class="hljs-property">ipcRenderer</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">'close'</span>);</span><br><span class="language-javascript">            },</span><br><span class="language-javascript">            <span class="hljs-title function_">minWindow</span>(<span class="hljs-params"></span>) {</span><br><span class="language-javascript">                electron.<span class="hljs-property">ipcRenderer</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">'min'</span>); <span class="hljs-comment">// 通过 ipcRenderer 发送 min 消息</span></span><br><span class="language-javascript">            },</span><br><span class="language-javascript">            <span class="hljs-title function_">resizeWindow</span>(<span class="hljs-params"></span>) {</span><br><span class="language-javascript">                electron.<span class="hljs-property">ipcRenderer</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">'max'</span>); <span class="hljs-comment">// 通过 ipcRenderer 发送 max 消息</span></span><br><span class="language-javascript">            },</span><br><span class="language-javascript">        },</span><br><span class="language-javascript">    };</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p>现在，我们的窗口就能成功实现最小化最大化以及关闭窗口的功能了。<br>接下来，我们还需要让 vue 能够知道每一次的窗口变化，以及时更新 <code>data</code> 中的 <code>maxSize</code>。<br>还记得我们之前讨论过的 <code>win.on</code> 吗？实际上，窗口大小的改变它也是能够监听的：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createWindow</span>(<span class="hljs-params"></span>) {<br>    <span class="hljs-keyword">const</span> win = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BrowserWindow</span>({ ... });<br>    <span class="hljs-comment">// ...</span><br>    win.<span class="hljs-title function_">on</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-function">() =&gt;</span> {<br>        win.<span class="hljs-property">webContents</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">'resize'</span>, win.<span class="hljs-title function_">isMaximized</span>())<br>    })<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>这里我们让窗口监听 <strong>resize</strong> 事件，每当发生大小改变时，就将窗口是否最大化作为载荷，使用 <code>win.webContents.send</code> 发送 resize 事件给 <strong>win</strong> 窗口所加载的 <strong>SPA</strong>。<br>这样一来，我们还需要在 vue 页面中接收这条 resize 消息。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">created</span>(<span class="hljs-params"></span>) {<br>    <span class="hljs-comment">// 当 vue 页面创建完成后直接进行事件监听</span><br>    electron.<span class="hljs-property">ipcRenderer</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">"resize"</span>, <span class="hljs-function">(<span class="hljs-params">event, params</span>) =&gt;</span> {<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxSize</span> !== params) {<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxSize</span> = params;<br>            <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">"maxSize"</span>, params);<br>        }<br>    })<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>这样一来，我们的 vue 页面就可以随时获取窗口大小的变化，并根据当前窗口是否最大化来切换右上角的按钮图标了。</p>
<h1><span id="%E5%BC%95%E5%85%A5-mavon-editor">引入 Mavon-editor</span></h1><p>虽然自己通过 <strong>marked</strong> 和 <strong>highlight.js</strong> 也能实现一个简单的 Markdown 文本渲染组件，但效果终究比不过其他较为成熟的开源组件。因此，我们这里直接使用一款基于 <strong>Vue</strong> 的强大的开源 Markdown 编辑器 —— <strong>mavon-editor</strong> 。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yarn add mavon-editor <span class="hljs-comment"># 为项目添加 mavon-editor 依赖</span><br></code></pre></td></tr></tbody></table></figure>

<p>接下来我们修改 Vue 项目的 main.js ：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// ...</span><br><span class="hljs-keyword">import</span> mavonEditor <span class="hljs-keyword">from</span> <span class="hljs-string">'mavon-editor'</span>; <span class="hljs-comment">// 引入 mavon-editor 组件</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">'mavon-editor/dist/css/index.css'</span>; <span class="hljs-comment">// 引入 mavon-editor 需要的样式文件</span><br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(mavonEditor); <span class="hljs-comment">// Vue 全局注册组件</span><br></code></pre></td></tr></tbody></table></figure>

<p>现在我们就可以在项目中使用该组件了。我们现在来修改一下项目的 GUI。<br>我们为 App 添加一个身体分区，里面放置菜单栏和我们的 mavon-editor 组件。</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"head"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./assets/logo.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">" "</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"windowLogo"</span> /&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">span</span></span><br><span class="hljs-tag">                &gt;</span>Typark{{filePath?' - ' + filePath.split("/")[filePath.split("/").length -<br>                1]:''}}&lt;/span<br>            &gt;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"windowBtn"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"closeWindowBtn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"closeWindow"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-close"</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"windowBtn"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"resizeBtn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"resizeWindow"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"maxSize?'el-icon-copy-document':'el-icon-full-screen'"</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"windowBtn"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"miniSizeBtn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"minWindow"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-minus"</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"body"</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 菜单工具栏，现在先不添加功能 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"toolbars"</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"mini"</span> <span class="hljs-attr">trigger</span>=<span class="hljs-string">"click"</span> <span class="hljs-attr">placement</span>=<span class="hljs-string">"bottom-start"</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>文件(F)<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-menu</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"dropdown"</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span> <span class="hljs-attr">command</span>=<span class="hljs-string">"open"</span>&gt;</span>打开<span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-item</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span> <span class="hljs-attr">command</span>=<span class="hljs-string">"save"</span> <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"rawText===''"</span> <span class="hljs-attr">:divided</span>=<span class="hljs-string">"true"</span></span><br><span class="hljs-tag">                            &gt;</span>另存为&lt;/el-dropdown-item<br>                        &gt;<br>                        <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span> <span class="hljs-attr">command</span>=<span class="hljs-string">"html"</span> <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"rawText===''"</span> <span class="hljs-attr">:divided</span>=<span class="hljs-string">"true"</span></span><br><span class="hljs-tag">                            &gt;</span>导出为HTML&lt;/el-dropdown-item<br>                        &gt;<br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-menu</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>            <span class="hljs-comment">&lt;!-- 主体部分，放置 mavon-editor 组件 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span><br><span class="hljs-tag">                <span class="hljs-attr">class</span>=<span class="hljs-string">"main"</span></span><br><span class="hljs-tag">                <span class="hljs-attr">v-loading</span>=<span class="hljs-string">"outputing"</span></span><br><span class="hljs-tag">                <span class="hljs-attr">element-loading-text</span>=<span class="hljs-string">"拼命导出中"</span></span><br><span class="hljs-tag">                <span class="hljs-attr">element-loading-spinner</span>=<span class="hljs-string">"el-icon-loading"</span></span><br><span class="hljs-tag">                <span class="hljs-attr">element-loading-background</span>=<span class="hljs-string">"rgba(0, 0, 0, 0.8)"</span></span><br><span class="hljs-tag">            &gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">mavon-editor</span></span><br><span class="hljs-tag">                    <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 100%; width: 100%;"</span></span><br><span class="hljs-tag">                    <span class="hljs-attr">:toolbars</span>=<span class="hljs-string">"markdownOption"</span></span><br><span class="hljs-tag">                    <span class="hljs-attr">v-model</span>=<span class="hljs-string">"rawText"</span></span><br><span class="hljs-tag">                    <span class="hljs-attr">ref</span>=<span class="hljs-string">"md"</span></span><br><span class="hljs-tag">                /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {</span><br><span class="language-javascript">        <span class="hljs-comment">// ... ,</span></span><br><span class="language-javascript">        <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) {</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> {</span><br><span class="language-javascript">                <span class="hljs-comment">// ... ,</span></span><br><span class="language-javascript">                <span class="hljs-attr">rawText</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// markdown 源码</span></span><br><span class="language-javascript">                <span class="hljs-attr">outputing</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 正在导出</span></span><br><span class="language-javascript">                <span class="hljs-attr">markdownOption</span>: {</span><br><span class="language-javascript">                    <span class="hljs-comment">// mavon-editor 配置</span></span><br><span class="language-javascript">                    <span class="hljs-attr">bold</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 粗体</span></span><br><span class="language-javascript">                    <span class="hljs-attr">italic</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 斜体</span></span><br><span class="language-javascript">                    <span class="hljs-attr">header</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 标题</span></span><br><span class="language-javascript">                    <span class="hljs-attr">underline</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 下划线</span></span><br><span class="language-javascript">                    <span class="hljs-attr">strikethrough</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 中划线</span></span><br><span class="language-javascript">                    <span class="hljs-attr">mark</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 标记</span></span><br><span class="language-javascript">                    <span class="hljs-attr">superscript</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 上角标</span></span><br><span class="language-javascript">                    <span class="hljs-attr">subscript</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 下角标</span></span><br><span class="language-javascript">                    <span class="hljs-attr">quote</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 引用</span></span><br><span class="language-javascript">                    <span class="hljs-attr">ol</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 有序列表</span></span><br><span class="language-javascript">                    <span class="hljs-attr">ul</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 无序列表</span></span><br><span class="language-javascript">                    <span class="hljs-attr">link</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 链接</span></span><br><span class="language-javascript">                    <span class="hljs-attr">imagelink</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 图片链接</span></span><br><span class="language-javascript">                    <span class="hljs-attr">code</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// code</span></span><br><span class="language-javascript">                    <span class="hljs-attr">table</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 表格</span></span><br><span class="language-javascript">                    <span class="hljs-attr">fullscreen</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 全屏编辑</span></span><br><span class="language-javascript">                    <span class="hljs-attr">readmodel</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 沉浸式阅读</span></span><br><span class="language-javascript">                    <span class="hljs-attr">htmlcode</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 展示html源码</span></span><br><span class="language-javascript">                    <span class="hljs-attr">help</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 帮助</span></span><br><span class="language-javascript">                    <span class="hljs-comment">/* 1.3.5 */</span></span><br><span class="language-javascript">                    <span class="hljs-attr">undo</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 上一步</span></span><br><span class="language-javascript">                    <span class="hljs-attr">redo</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 下一步</span></span><br><span class="language-javascript">                    <span class="hljs-attr">trash</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 清空</span></span><br><span class="language-javascript">                    <span class="hljs-attr">save</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 保存（触发events中的save事件）</span></span><br><span class="language-javascript">                    <span class="hljs-comment">/* 1.4.2 */</span></span><br><span class="language-javascript">                    <span class="hljs-attr">navigation</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 导航目录</span></span><br><span class="language-javascript">                    <span class="hljs-comment">/* 2.1.8 */</span></span><br><span class="language-javascript">                    <span class="hljs-attr">alignleft</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 左对齐</span></span><br><span class="language-javascript">                    <span class="hljs-attr">aligncenter</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 居中</span></span><br><span class="language-javascript">                    <span class="hljs-attr">alignright</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 右对齐</span></span><br><span class="language-javascript">                    <span class="hljs-comment">/* 2.2.1 */</span></span><br><span class="language-javascript">                    <span class="hljs-attr">subfield</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 单双栏模式</span></span><br><span class="language-javascript">                    <span class="hljs-attr">preview</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 预览</span></span><br><span class="language-javascript">                },</span><br><span class="language-javascript">            };</span><br><span class="language-javascript">        },</span><br><span class="language-javascript">    };</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">    <span class="hljs-comment">/* ... */</span></span><br><span class="language-css">    <span class="hljs-selector-class">.body</span> {</span><br><span class="language-css">        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;</span><br><span class="language-css">        <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">2.5em</span>);</span><br><span class="language-css">        <span class="hljs-attribute">overflow</span>: hidden;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-class">.toolbars</span> {</span><br><span class="language-css">        <span class="hljs-attribute">height</span>: <span class="hljs-number">1.5em</span>;</span><br><span class="language-css">        <span class="hljs-attribute">user-select</span>: none;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-class">.toolbars</span> <span class="hljs-selector-tag">button</span> {</span><br><span class="language-css">        <span class="hljs-attribute">height</span>: <span class="hljs-number">1.5em</span>;</span><br><span class="language-css">        <span class="hljs-attribute">border</span>: none;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-class">.toolbars</span> <span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:hover</span> {</span><br><span class="language-css">        <span class="hljs-attribute">background</span>: <span class="hljs-number">#e0e0e0</span>;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-class">.el-dropdown-menu</span> {</span><br><span class="language-css">        <span class="hljs-attribute">user-select</span>: none;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-class">.main</span> {</span><br><span class="language-css">        -webkit-app-region: no-drag;</span><br><span class="language-css">        <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;</span><br><span class="language-css">        <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100vh</span> - <span class="hljs-number">4em</span>);</span><br><span class="language-css">        <span class="hljs-attribute">overflow-x</span>: hidden;</span><br><span class="language-css">        <span class="hljs-attribute">overflow-y</span>: overlay;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-class">.markdown-body</span> <span class="hljs-selector-tag">img</span> {</span><br><span class="language-css">        <span class="hljs-attribute">max-height</span>: <span class="hljs-number">100%</span>;</span><br><span class="language-css">    }</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p>这么一来，我们的应用的界面就绘制完成了。让我们来看看效果：<br><img data-fancybox="gallery" data-sizes="auto" data-src="https://img-blog.csdnimg.cn/863ea2ec7aae44349d02c6c0ca85264c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5bCP5qCX5bi95LuK5aSp5ZCD5LuA5LmI,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述" class="lazyload"><br>嗯，显示效果不错，现在让我们为它添加一些功能，让它能够更加贴近实用吧。</p>
<h1><span id="electron-%E6%93%8D%E4%BD%9C%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6">electron 操作本地文件</span></h1><p>我们首先来为应用的菜单栏添加一些功能接口。<br>我们先修改一下菜单栏的代码：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- ... --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"mini"</span> <span class="hljs-attr">trigger</span>=<span class="hljs-string">"click"</span> <span class="hljs-attr">placement</span>=<span class="hljs-string">"bottom-start"</span> @<span class="hljs-attr">command</span>=<span class="hljs-string">"fileCommand"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>文件(F)<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-menu</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"dropdown"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span> <span class="hljs-attr">command</span>=<span class="hljs-string">"open"</span>&gt;</span>打开<span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-item</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span> <span class="hljs-attr">command</span>=<span class="hljs-string">"save"</span> <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"rawText===''"</span> <span class="hljs-attr">:divided</span>=<span class="hljs-string">"true"</span></span><br><span class="hljs-tag">                &gt;</span>另存为&lt;/el-dropdown-item<br>            &gt;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span> <span class="hljs-attr">command</span>=<span class="hljs-string">"html"</span> <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"rawText===''"</span> <span class="hljs-attr">:divided</span>=<span class="hljs-string">"true"</span></span><br><span class="hljs-tag">                &gt;</span>导出为HTML&lt;/el-dropdown-item<br>            &gt;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-menu</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- ... --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {</span><br><span class="language-javascript">        <span class="hljs-comment">// ... ,</span></span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: {</span><br><span class="language-javascript">            <span class="hljs-comment">// ... ,</span></span><br><span class="language-javascript">            <span class="hljs-title function_">fileCommand</span>(<span class="hljs-params">command</span>) {</span><br><span class="language-javascript">                <span class="hljs-keyword">switch</span> (command) {</span><br><span class="language-javascript">                    <span class="hljs-keyword">case</span> <span class="hljs-string">'open'</span>: {</span><br><span class="language-javascript">                        <span class="hljs-comment">// 打开 markdown 文件</span></span><br><span class="language-javascript">                        electron.<span class="hljs-property">ipcRenderer</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">'openFile'</span>);</span><br><span class="language-javascript">                        <span class="hljs-keyword">break</span>;</span><br><span class="language-javascript">                    }</span><br><span class="language-javascript">                    <span class="hljs-keyword">case</span> <span class="hljs-string">'save'</span>: {</span><br><span class="language-javascript">                        <span class="hljs-comment">// 另存为</span></span><br><span class="language-javascript">                        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rawText</span>) {</span><br><span class="language-javascript">                            electron.<span class="hljs-property">ipcRenderer</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">'saveNewFile'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">rawText</span>);</span><br><span class="language-javascript">                        }</span><br><span class="language-javascript">                        <span class="hljs-keyword">break</span>;</span><br><span class="language-javascript">                    }</span><br><span class="language-javascript">                    <span class="hljs-keyword">case</span> <span class="hljs-string">'html'</span>: {</span><br><span class="language-javascript">                        <span class="hljs-comment">// 导出 html 文件</span></span><br><span class="language-javascript">                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">outputing</span> = <span class="hljs-literal">true</span>;</span><br><span class="language-javascript">                        <span class="hljs-keyword">let</span> filename = <span class="hljs-string">''</span>;</span><br><span class="language-javascript">                        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">filePath</span>) {</span><br><span class="language-javascript">                            filename =</span><br><span class="language-javascript">                                <span class="hljs-variable language_">this</span>.<span class="hljs-property">filePath</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\\'</span>)[<span class="hljs-variable language_">this</span>.<span class="hljs-property">filePath</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\\'</span>).<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];</span><br><span class="language-javascript">                            filename = filename.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, filename.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">'.'</span>));</span><br><span class="language-javascript">                        }</span><br><span class="language-javascript">                        electron.<span class="hljs-property">ipcRenderer</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">'saveAsHtml'</span>, filename, <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">md</span>.<span class="hljs-property">d_render</span>);</span><br><span class="language-javascript">                        <span class="hljs-keyword">break</span>;</span><br><span class="language-javascript">                    }</span><br><span class="language-javascript">                }</span><br><span class="language-javascript">            },</span><br><span class="language-javascript">        },</span><br><span class="language-javascript">    };</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p>接下来我们将为 electron 应用书写监听方法。在这之前我们需要先为项目添加一些依赖：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yarn add fs-extra<br></code></pre></td></tr></tbody></table></figure>

<h2><span id="%E6%89%93%E5%BC%80-markdown-%E6%96%87%E4%BB%B6">打开 markdown 文件</span></h2><p>该功能用于选择本地的 markdown 文件，并将文件的文件名以及内容发送给 vue 页面，将数据展示在页面中。我们在 <strong>background.js</strong> 中，为 <strong>ipc</strong> 添加一个打开文件的监听事件：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> { app, protocol, <span class="hljs-title class_">BrowserWindow</span>, dialog } <span class="hljs-keyword">from</span> <span class="hljs-string">'electron'</span>;<br><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs-extra'</span>; <span class="hljs-comment">// 使用fs模块</span><br><span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createMainWindow</span>(<span class="hljs-params"></span>) {<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-keyword">const</span> ipc = <span class="hljs-built_in">require</span>(<span class="hljs-string">'electron'</span>).<span class="hljs-property">ipcMain</span>;<br>    <span class="hljs-comment">// ...</span><br>    ipc.<span class="hljs-title function_">on</span>(<span class="hljs-string">'openFile'</span>, <span class="hljs-function">() =&gt;</span> {<br>        dialog<br>            .<span class="hljs-title function_">showOpenDialog</span>({<br>                <span class="hljs-comment">// 通过 dialog 模块显示 “打开文件” 对话框</span><br>                <span class="hljs-attr">properties</span>: [<span class="hljs-string">'openFile'</span>], <span class="hljs-comment">// 参数选择打开文件</span><br>                <span class="hljs-attr">filters</span>: [<br>                    {<br>                        <span class="hljs-attr">name</span>: <span class="hljs-string">'Markdown File'</span>,<br>                        <span class="hljs-attr">extensions</span>: [<br>                            <span class="hljs-string">'md'</span>,<br>                            <span class="hljs-string">'markdown'</span>,<br>                            <span class="hljs-string">'mmd'</span>,<br>                            <span class="hljs-string">'mkd'</span>,<br>                            <span class="hljs-string">'mdwn'</span>,<br>                            <span class="hljs-string">'mdown'</span>,<br>                            <span class="hljs-string">'mdx'</span>,<br>                            <span class="hljs-string">'mdtxt'</span>,<br>                            <span class="hljs-string">'apib'</span>,<br>                            <span class="hljs-string">'rmarkdown'</span>,<br>                            <span class="hljs-string">'rmd'</span>,<br>                            <span class="hljs-string">'txt'</span>,<br>                            <span class="hljs-string">'text'</span>,<br>                        ],<br>                    },<br>                ], <span class="hljs-comment">// 文件类型过滤器，只留下 markdown 文件</span><br>            })<br>            .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {<br>                <span class="hljs-keyword">if</span> (res &amp;&amp; res.<span class="hljs-property">filePaths</span> &amp;&amp; res.<span class="hljs-property">filePaths</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {<br>                    <span class="hljs-comment">// 如果选择了文件</span><br>                    fs.<span class="hljs-title function_">readFile</span>(res.<span class="hljs-property">filePaths</span>[<span class="hljs-number">0</span>], <span class="hljs-string">'utf8'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {<br>                        <span class="hljs-comment">// 通过 fs-extra 读取文件内容</span><br>                        <span class="hljs-keyword">if</span> (err) {<br>                            <span class="hljs-comment">// 读取失败</span><br>                            win.<span class="hljs-property">webContents</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">'openedFile'</span>, -<span class="hljs-number">1</span>);<br>                        } <span class="hljs-keyword">else</span> {<br>                            <span class="hljs-comment">// 读取成功，将内容发送给 vue 项目</span><br>                            win.<span class="hljs-property">webContents</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">'openedFile'</span>, <span class="hljs-number">0</span>, res.<span class="hljs-property">filePaths</span>[<span class="hljs-number">0</span>], data);<br>                        }<br>                    });<br>                }<br>            });<br>    });<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>现在我们需要在 vue 页面中添加对应的监听。由于后续我们还需要添加更多的监听事件，因此，为了维护方便，我们不再将创建监听的函数写在 <code>created</code> 中，而是单独为他们创建一个方法：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {<br>    <span class="hljs-comment">// ... ,</span><br>    <span class="hljs-attr">methods</span>: {<br>        <span class="hljs-comment">// ... ,</span><br>        <span class="hljs-title function_">initIpcRenderers</span>(<span class="hljs-params"></span>) {<br>            electron.<span class="hljs-property">ipcRenderer</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-function">(<span class="hljs-params">event, params</span>) =&gt;</span> {<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxSize</span> !== params) {<br>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxSize</span> = params;<br>                    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'maxSize'</span>, params);<br>                }<br>            });<br>            electron.<span class="hljs-property">ipcRenderer</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'openedFile'</span>, <span class="hljs-function">(<span class="hljs-params">e, status, path, data</span>) =&gt;</span> {<br>                <span class="hljs-keyword">if</span> (status === <span class="hljs-number">0</span>) {<br>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">filePath</span> = path;<br>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rawText</span> = data;<br>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">initRawText</span> = data;<br>                } <span class="hljs-keyword">else</span> {<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'读取失败'</span>);<br>                }<br>            });<br>        },<br>    },<br>    <span class="hljs-title function_">created</span>(<span class="hljs-params"></span>) {<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initIpcRenderers</span>();<br>    },<br>};<br></code></pre></td></tr></tbody></table></figure>

<p>现在，我们就可以通过点击 <strong>文件 - 打开</strong> 按钮，打开本地的 markdown 文件了。同时，打开后的文件名也将呈现在标题栏中。</p>
<h2><span id="%E5%8F%A6%E5%AD%98%E4%B8%BA%E6%96%B0%E6%96%87%E4%BB%B6">另存为新文件</span></h2><p>有了打开文件，那么我们还需要一个写入本地文件的 API。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs js">ipc.<span class="hljs-title function_">on</span>(<span class="hljs-string">'saveNewFile'</span>, <span class="hljs-function">(<span class="hljs-params">event, data</span>) =&gt;</span> {<br>    dialog<br>        .<span class="hljs-title function_">showSaveDialog</span>({<br>            <span class="hljs-comment">// 通过 dialog 模块打开 保存文件 对话框</span><br>            <span class="hljs-attr">title</span>: <span class="hljs-string">'文件另存为'</span>,<br>            <span class="hljs-attr">defaultPath</span>: path.<span class="hljs-title function_">join</span>(<br>                __dirname,<br>                <span class="hljs-string">`<span class="hljs-subst">${data</span></span><br><span class="hljs-subst"><span class="hljs-string">                    .replace(</span></span><br><span class="hljs-subst"><span class="hljs-string">                        /\\|\/|\?|\？|\*|\<span class="hljs-string">"|\“|\”|\'|\‘|\’|\&lt;|\&gt;|\{|\}|\[|\]|\【|\】|\：|\:|\、|\^|\$|\!|\~|\`|\|/g,</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        ''</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    )</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    .substring(0, 10)}.md`</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">            ), // 默认文件保存路径</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">            filters: [</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                {</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    name: 'Markdown File',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    extensions: [</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        'md',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        'markdown',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        'mmd',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        'mkd',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        'mdwn',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        'mdown',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        'mdx',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        'mdtxt',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        'apib',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        'rmarkdown',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        'rmd',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        'txt',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        'text',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    ],</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                },</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">            ], // 文件类型过滤器，只保留为 markdown 文件</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">        })</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">        .then((res) =&gt; {</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">            if (res &amp;&amp; res.filePath) {</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                fs.writeFile(res.filePath, data, 'utf8', (err) =&gt; {</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    if (err) {</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        win.webContents.send('savedNewFile', -1);</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    } else {</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        // 写入成功，返回保存路径</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        win.webContents.send('savedNewFile', 0, res.filePath);</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    }</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                });</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">            }</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">        });</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">});</span></span></span><br></code></pre></td></tr></tbody></table></figure>

<h2><span id="%E5%AF%BC%E5%87%BA%E4%B8%BA-html">导出为 HTML</span></h2><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs js">ipc.<span class="hljs-title function_">on</span>(<span class="hljs-string">'saveAsHtml'</span>, <span class="hljs-function">(<span class="hljs-params">event, filename, data</span>) =&gt;</span> {<br>    <span class="hljs-keyword">let</span> htmlpath;<br>    <span class="hljs-keyword">if</span> (filename) {<br>        <span class="hljs-comment">// 如果当前文件存在，直接用文件名作为 html 的文件名</span><br>        htmlpath = path.<span class="hljs-title function_">join</span>(__dirname, filename);<br>    } <span class="hljs-keyword">else</span> {<br>        <span class="hljs-comment">// 否则从渲染的 html 文本中提取</span><br>        htmlpath = path.<span class="hljs-title function_">join</span>(<br>            __dirname,<br>            <span class="hljs-string">`<span class="hljs-subst">${data</span></span><br><span class="hljs-subst"><span class="hljs-string">                .replace(</span></span><br><span class="hljs-subst"><span class="hljs-string">                    /\\|\/|\?|\？|\*|\<span class="hljs-string">"|\“|\”|\'|\‘|\’|\&lt;|\&gt;|\{|\}|\[|\]|\【|\】|\：|\:|\、|\^|\$|\!|\~|\`|\|/g,</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    ''</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                )</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                .substring(0, 10)}.html`</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">        );</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">    }</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">    dialog</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">        .showSaveDialog({</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">            title: '导出为HTML',</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">            defaultPath: htmlpath,</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">            filters: [{ name: 'HTML', extensions: ['html'] }],</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">        })</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">        .then((res) =&gt; {</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">            if (res) {</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                if (res.canceled) {</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    mainWindow.webContents.send('savedAsHtml', -1);</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                } else if (res.filePath) {</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    const title = res.filePath.split('\\')[res.filePath.split('\\').length - 1];</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    // 此处写入基本的 html 代码，其中包含了需要的 css 样式文件</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    let html = `&lt;!doctype html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;meta charset='UTF-8'&gt;&lt;meta name='viewport' content='width=device-width initial-scale=1'&gt;\n&lt;link href="</span>https://cdn.bootcss.com/github-markdown-css/<span class="hljs-number">2.10</span><span class="hljs-number">.0</span>/github-markdown.min.css<span class="hljs-string">" rel="</span>stylesheet<span class="hljs-string">"&gt;\n&lt;link rel="</span>stylesheet<span class="hljs-string">" href="</span>https://cdnjs.cloudflare.com/ajax/libs/highlight.js/<span class="hljs-number">11.3</span><span class="hljs-number">.1</span>/styles/github.min.css<span class="hljs-string">" id="</span>md-code-style<span class="hljs-string">"&gt;\n&lt;title&gt;${title}&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;div class="</span>markdown-body<span class="hljs-string">"&gt;\n${data}\n&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;`;</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    fs.writeFile(res.filePath, html, 'utf8', (err) =&gt; {</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        if (err) {</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                            mainWindow.webContents.send('savedAsHtml', 1, err);</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        } else {</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                            mainWindow.webContents.send('savedAsHtml', 0);</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                        }</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                    });</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">                }</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">            }</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">        });</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">});</span></span></span><br></code></pre></td></tr></tbody></table></figure>

<h2><span id="%E7%BC%96%E8%BE%91%E6%97%B6%E4%BF%9D%E5%AD%98%E6%96%87%E4%BB%B6">编辑时保存文件</span></h2><p><strong>mavon-editor</strong> 为我们保留了一个保存文件的接口，可以通过快捷键 <code>Ctrl + S</code> 触发（也可以通过按钮触发，但是我们在 <code>markdownOptions</code> 中将它隐藏了），但是具体的逻辑需要我们自己来实现。<br>首先，我们为 mavon-editor 添加上保存方法的钩子：</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">mavon-editor</span> @<span class="hljs-attr">save</span>=<span class="hljs-string">"save"</span> /&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">save</span>(<span class="hljs-params"></span>) {<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">filePath</span>) { <span class="hljs-comment">// 如果此时打开的是本地文件，则进行保存操作</span><br>        <span class="hljs-variable language_">window</span>.<span class="hljs-property">electron</span>.<span class="hljs-property">ipcRenderer</span>.<span class="hljs-title function_">send</span>(<br>            <span class="hljs-string">"saveFile"</span>,<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">filePath</span>,<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">rawText</span><br>        );<br>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rawText</span>) { <span class="hljs-comment">// 否则进行另存为操作</span><br>        <span class="hljs-variable language_">window</span>.<span class="hljs-property">electron</span>.<span class="hljs-property">ipcRenderer</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">"saveNewFile"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">rawText</span>);<br>    }<br>},<br></code></pre></td></tr></tbody></table></figure>

<p>我们已经写好了另存为操作的 ipc 监听，现在我们再加上一个保存已有文件的监听：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">ipc.<span class="hljs-title function_">on</span>(<span class="hljs-string">'saveFile'</span>, <span class="hljs-function">(<span class="hljs-params">event, path, data</span>) =&gt;</span> {<br>    fs.<span class="hljs-title function_">writeFile</span>(path, data, <span class="hljs-string">'utf8'</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {<br>        <span class="hljs-keyword">if</span> (err) {<br>            win.<span class="hljs-property">webContents</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">'savedFile'</span>, -<span class="hljs-number">1</span>);<br>        } <span class="hljs-keyword">else</span> {<br>            win.<span class="hljs-property">webContents</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">'savedFile'</span>, <span class="hljs-number">0</span>);<br>        }<br>    });<br>});<br></code></pre></td></tr></tbody></table></figure>

<p>这样，我们就完成了一个基本的能够实现读写 markdown 文件的编辑器。</p>
<h2><span id="%E5%AF%BC%E5%85%A5%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87">导入本地图片</span></h2><p>这里需要特别注意这个功能！各位读者如果有耐心阅读到了这里，不妨尝试一下利用 <strong>mavon-editor</strong> 向你的 markdown 源码中添加一张本地的图片试试，你会发现本地的图片是无法解析的。这里我不做过多赘述，简单说明一下解决方法：这个问题是因为 XSS 防御过滤掉了高危属性，你可以为 <strong>mavon-editor</strong> 标签添加 <code>:xssOptions="false"</code> 属性关闭 XSS 来解决这个问题。<br>同时，当通过粘贴的方式添加本地图片时，由于图片本身不存在本地，我建议为图片做一份备份，放置在 electron 应用的安装目录下。接下来我们来实现这一功能。</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">mavon-editor</span> @<span class="hljs-attr">imgAdd</span>=<span class="hljs-string">"imgAdd"</span> /&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {<br>    <span class="hljs-comment">// ... ,</span><br>    <span class="hljs-attr">methods</span>: {<br>        <span class="hljs-comment">// ... ,</span><br>        <span class="hljs-title function_">imgAdd</span>(<span class="hljs-params">filename, imgfile</span>) {<br>            <span class="hljs-keyword">if</span> (imgfile.<span class="hljs-property">path</span> !== <span class="hljs-string">''</span>) {<br>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">rawText</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rawText</span>.<span class="hljs-title function_">replace</span>(<br>                    <span class="hljs-string">`![<span class="hljs-subst">${imgfile._name}</span>](<span class="hljs-subst">${filename}</span>)`</span>,<br>                    <span class="hljs-string">`![<span class="hljs-subst">${imgfile._name}</span>](<span class="hljs-subst">${imgfile.path.replace(/\\/g, <span class="hljs-string">'/'</span>)}</span>)`</span><br>                );<br>            } <span class="hljs-keyword">else</span> {<br>                electron.<span class="hljs-property">ipcRenderer</span>.<span class="hljs-title function_">send</span>(<br>                    <span class="hljs-string">'pastePicture'</span>,<br>                    imgfile.<span class="hljs-property">miniurl</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>)[<span class="hljs-number">1</span>],<br>                    imgfile.<span class="hljs-property">type</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>)[<span class="hljs-number">1</span>],<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">valueOf</span>(),<br>                    filename,<br>                    imgfile.<span class="hljs-property">_name</span><br>                );<br>            }<br>        },<br>    },<br>};<br></code></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// background.js</span><br>ipc.<span class="hljs-title function_">on</span>(<span class="hljs-string">'pastePicture'</span>, <span class="hljs-function">(<span class="hljs-params">event, imgdata, imgtype, timestamp, filename, tagname</span>) =&gt;</span> {<br>    <span class="hljs-keyword">let</span> destpath; <span class="hljs-comment">// 定义 目标路径 变量</span><br>    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'development'</span>) {<br>        <span class="hljs-comment">// 处于开发模式下</span><br>        destpath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'user-images'</span>);<br>    } <span class="hljs-keyword">else</span> {<br>        destpath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'../user-images'</span>);<br>    }<br>    <span class="hljs-keyword">const</span> dirExists = fs.<span class="hljs-title function_">pathExistsSync</span>(destpath); <span class="hljs-comment">// 判断文件夹是否存在</span><br>    <span class="hljs-keyword">if</span> (!dirExists) {<br>        fs.<span class="hljs-title function_">mkdirSync</span>(destpath); <span class="hljs-comment">// 若不存在则创建该文件夹</span><br>    }<br>    <span class="hljs-keyword">let</span> exists = fs.<span class="hljs-title function_">existsSync</span>(path.<span class="hljs-title function_">join</span>(destpath, <span class="hljs-string">`typark<span class="hljs-subst">${timestamp}</span>.<span class="hljs-subst">${imgtype}</span>`</span>));<br>    <span class="hljs-keyword">while</span> (exists) {<br>        exists = fs.<span class="hljs-title function_">existsSync</span>(path.<span class="hljs-title function_">join</span>(destpath, <span class="hljs-string">`typark<span class="hljs-subst">${++timestamp}</span>.<span class="hljs-subst">${imgtype}</span>`</span>)); <span class="hljs-comment">// 如果文件重名，时间戳加一，直到不出现重名为止</span><br>    }<br>    fs.<span class="hljs-title function_">writeFile</span>(<br>        path.<span class="hljs-title function_">join</span>(destpath, <span class="hljs-string">`typark<span class="hljs-subst">${timestamp}</span>.<span class="hljs-subst">${imgtype}</span>`</span>),<br>        <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(imgdata, <span class="hljs-string">'base64'</span>),<br>        <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {<br>            <span class="hljs-keyword">if</span> (err) {<br>                mainWindow.<span class="hljs-property">webContents</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">'pastedPicture'</span>, -<span class="hljs-number">1</span>);<br>            } <span class="hljs-keyword">else</span> {<br>                <span class="hljs-comment">// 写入成功后返回 markdown 源码中的图片信息以及保存后的图片路径用于替换</span><br>                mainWindow.<span class="hljs-property">webContents</span>.<span class="hljs-title function_">send</span>(<br>                    <span class="hljs-string">'pastedPicture'</span>,<br>                    <span class="hljs-number">0</span>,<br>                    path.<span class="hljs-title function_">join</span>(destpath, <span class="hljs-string">`typark<span class="hljs-subst">${timestamp}</span>.<span class="hljs-subst">${imgtype}</span>`</span>),<br>                    filename,<br>                    tagname<br>                );<br>            }<br>        }<br>    );<br>});<br></code></pre></td></tr></tbody></table></figure>

<h1><span id="%E7%BB%93%E5%B0%BE">结尾</span></h1><p>致此，我们已完成了一个简单的 markdown 文本编辑器的搭建。如果各位读者觉得对你有帮助的话，不妨来访问一下我对于这个应用的正式仓库：</p>
<ul>
<li><strong>github</strong>： <a target="_blank" rel="noopener" href="https://github.com/AioliaRegulus/Typark">Typark</a></li>
<li><strong>gitee</strong>： <a target="_blank" rel="noopener" href="https://gitee.com/ch1ny/typark">Typark</a></li>
</ul>
<p>这里有更加完善的功能，如果喜欢请帮忙点一颗小星星吧 ^ _ ^ ，感谢您的阅读！</p>
</body></html>
	</article>

	 
    <div class="kira-post-copyright">
        <strong>本文作者：</strong>德布罗煜<br>
        <strong>本文链接：</strong><a href="https://kira.host/blog/%E4%BD%BF%E7%94%A8Vue%E5%92%8CElectron%E5%BC%80%E5%8F%91%E4%B8%80%E6%AC%BE%E7%AE%80%E5%8D%95%E7%9A%84Markdown%E7%BC%96%E8%BE%91%E5%99%A8/" title="https:&#x2F;&#x2F;kira.host&#x2F;blog&#x2F;使用Vue和Electron开发一款简单的Markdown编辑器&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;kira.host&#x2F;blog&#x2F;使用Vue和Electron开发一款简单的Markdown编辑器&#x2F;</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
        
    </div>

  
	<div class="kira-post-nav">
		<nav class="post-nav">
			  
			<!-- 先找到与当前文字相同的目录 -->
			            
			<!-- 在找到当前文章所在的 index -->
			            
			<!-- 上一篇文章 -->
			<div class="old">
				<span>上一章</span>
				<a href="/blog/Unity%E4%BD%BF%E7%94%A8Newtonsoft%E6%8A%A5%E9%94%99%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"> Unity使用Newtonsoft报错的解决方案</a>
			</div>
			       
			<!-- 下一篇文章 -->
			<div class="new">
				<span>下一章</span>
				<a href="/blog/React/React%E5%85%A5%E9%97%A8/"> React入门</a>
			</div>
			                                                                                                                                                
		</nav>
	</div>
	
	<div class="kira-post-meta kira-rainbow">
		
			<a class="kirafont icon-container-fill -link" href="/blog/categories/%E7%BC%96%E7%A8%8B/">编程</a>
		
		
			<a class="kirafont icon-tag-fill -none-link" href="/blog/tags/Vue/" rel="tag">Vue</a> <a class="kirafont icon-tag-fill -none-link" href="/blog/tags/electron/" rel="tag">electron</a>
		
	</div>
	
	<div class="kira-post-footer">
		

		
	<div class="giscus"></div>
  
    <script src="https://giscus.app/client.js"
      data-repo="ch1ny/ch1ny.github.io"
      data-repo-id="R_kgDOHGgizw"
      data-category="General"
      data-category-id="DIC_kwDOHGgiz84CU88t"
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="top"
      data-theme="light"
      data-lang="en"
      data-loading="lazy"
      crossorigin="anonymous"
      async  
    ></script>
  

	</div>
	
</div>

				</div>
			</div>
			<div class="kira-right-column">
	<a onclick="document.querySelector('#kira-top-header').scrollIntoView({behavior: 'smooth'});" class="kira-backtotop" aria-label="回到顶部" title="回到顶部">
		<button class="mdui-fab mdui-ripple">
			<i class="kirafont icon-caret-up"></i>
		</button>
	</a>
</div>

		</div>
	</body>
</html>
